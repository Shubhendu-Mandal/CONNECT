<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">

<head id="Head1">

	<title>LOGIN - CONNECT</title>

	<meta name="viewport" content="initial-scale=1, maximum-scale=1">

	<link href='https://fonts.googleapis.com/css?family=Quattrocento' rel='stylesheet' type='text/css' />

	<link href='https://fonts.googleapis.com/css?family=Oswald:400,300' rel='stylesheet' type='text/css' />

	<style type="text/css">

		html { width: 100%; height: 100%; background: url('background.png') no-repeat center center; 
	  -webkit-background-size: cover;
  -moz-background-size: cover;
  -o-background-size: cover;
  background-size: cover;}
		body{
			font-family:"Quattrocento";font-weight:300;color:#333;text-align: center;
		}
	  	body *{
	  		box-sizing:border-box;
	  		
	  	}

		form {max-width:300px;margin:2em 1em 0 auto;}

		input[type=text] {width:calc(100% - 1.5em);padding:0.75em 0.5em;}

		#Main{background-color: #fff; width:56%;margin: auto; padding: 1em; margin-top: 10%;}

		.RightForm {max-width:300px;margin:2em auto 0 1em;}

		.LeftForm {max-width:300px;margin:2em auto 0 1em;}

		.topHeader{display: inline-block;}

		/*div.SignInContent {width:calc(60vw + 3em); min-width:calc(600px + 3em);margin:2em auto;}*/

		/*div.LeftArea {width:30vw;min-width:300px;margin:0 auto;}*/

		div.RightArea {float:right;width:30vw;min-width:300px;}

		div.Divider {height:10vh;min-height:350px;text-align:center;margin-bottom:4em;}

		div.DividerLine {width:350vh;height:1px;background: #dedede;margin-left: auto;margin-right: auto;}

		#IdentityProvidersList {margin-top:1.65em;}

		#MoreOptions{display: inline-block;}

		.circleText {padding:0.75em 1em;border:1px solid #dedede;border-radius:50%;cursor:default}

		.circleText span {position:relative;left:-0.55em;color:#dedede;}

		button.IdentityProvider {width: 46%;padding:15px; margin:10px;text-align: center;cursor: pointer;margin-bottom:1.5em;display: inline-block; background-color: #CC0A0A; color:#fff;	border:0px; font-weight: 700;font-size: 14px;}

		img.IdentityProviderImage {vertical-align: middle;}

		label {color: red;}

		.footer {font-size: 0.95em;float: left;color: #888888;height: 70px;width: 99%;	}

		.footer A {color: #888888;text-decoration: underline;}

		.link_divider {margin-left: 5px;margin-right: 5px;}

		.bottomHeader {background-color:#e4e4e4;text-align:left;}

		.bottomHeader h3 {padding:0.75em 1em;}

		.pageBanner {text-align:center;}

		h1, h3 {letter-spacing:1.25px;font-weight:500;font-family:"Oswald";cursor:default;}

		h3 a {color:#333;text-decoration:none;}

		.sign-up span{color:#CC0A0A;}

		#EmailAddressSubmitButton {display:block;margin-top:1em;padding:0.75em 1em;text-align:center;width:100%;cursor:pointer;}

		.siteLogo {background-image: url('connect_logo.png');height:3em;width:350px;display:block;background-size:300px 48px;background-repeat:no-repeat;padding:0.5em 1em;margin-top:1em; background-position: 50%;}

		@media screen and (max-width:766px)

		{

            div.LeftArea, div.RightArea, form, div.Divider, .RightForm, div#SignInContent {width:100%;max-width:none;display:inline;float:none;min-width:1px;}

            .RightForm, form {margin:0;}

            .circleText {max-width:0.5em;display:inline-block;position:relative;top:0.25em;}

            div.Divider {min-height:1px;height:3em;margin:1em auto;}

            div#Divider > .DividerLine:nth-child(3), div#Divider > .DividerLine:first-child {height:1px !important;width:calc(50% - 3em);display:inline-block;}

            button.IdentityProvider{
				width: 92%;
			}
			#Main{width: 95%;}
			.siteLogo{
				width: 300px;
			}


		}

		@media screen and (min-width:767px) and (max-width:1099px)

		{
			button.IdentityProvider{
				width: 80%;
			}
			button.IdentityProvider:first-child{
				border-bottom: 1px solid #ccc;
			}


		}
		@media screen and (min-width:1260px) 

		{
			#Main{width:49%;}


		}

	</style>

	<link rel="Stylesheet" href="/Areas/SSOManagement2/Theme/acs.css" type="text/css" />

	<script type="text/javascript">				
		function on_body_load() 
		{					
		}

		function GetCookieValue(cookie)
		{
			var cookies = document.cookie.split('; ');
			var results = {};

			for(var i = 0; i < cookies.length; i++)
			{
				var n = cookies[i].split('=');

				results[n[0]] = n[1];
			}

			if(typeof(results[cookie]) != 'undefined')
				return results[cookie];

			return '';
		}

	
		function GetQueryStringParameter(param) 
		{
			param = param.replace(/[\[]/, "\\\[").replace(/[\]]/, "\\\]");

			var exs = "[\\?&]" + param + "=([^&#]*)";
			var regex = new RegExp(exs);

			var results = regex.exec(window.location.href);

			if (results == null) 
			{
				return "";
			}
			else 
			{
				return decodeURIComponent(results[1].replace(/\+/g, " "));
			}
		}
		
		function logToConsole(message)
		{
			if(typeof(console) != 'undefined')
			{
				console.log(message);
			}
		}		
	</script>

</head>



<body onload="on_body_load()">
	<header></header>
	<div id="Main" style="display:none">
	<div class="topHeader"><a href="/" class="siteLogo"></a></div>
		<div id="SignInContent" class="SignInContent">
			<div id="LeftArea" class="LeftArea">
					<h1>Sign In</h1>
					<div id="IdentityProvidersList"></div><br />
					<!--<div id="MoreOptions"><a href="" onclick="ShowDefaultSigninPage(); return false;">Show more options</a></div>-->	
					<h3 class="sign-up"><a href="Registration/SignUp_UserType.html">Don't have an account? Click <span>HERE</span> to sign up.</a></h3>							
			</div>
			<!--<div id="Divider" class="Divider">
				<div class="circleText" style="padding:5px;"><span>OR</span></div>
				<div class="DividerLine" style="float:left;"></div>				
				<div class="DividerLine" style="float:right;"></div>
			</div>
			<div id="RightArea" class="RightArea">
				<div class="Rightform">
					<h3>Don't have an account? <a href="#">SIGN UP</a></h3>	
					<form onsubmit="EmailAddressEntered(); return false;">
						<input type="text" id="EmailAddressTextBox" placeholder="Email Address"/>
						<input type="submit" id="EmailAddressSubmitButton" value="LOGIN" />
						<label id="EmailAddressError"></label>
					</form>
				</div>
			</div>-->
		</div>
	</div>

	<script language="javascript" type="text/javascript">
        var identityProvidersoriginal = [];
		var cookieName = "ACSChosenIdentityProvider-38156528";
		var cookieExpiration = 30; // days
		var maxImageWidth = 240;
		var maxImageHeight = 40;
		var identityProviders = [];

		logToConsole('domain: ' + domain);

		// This function will be called back by the HRD metadata, and is responsible for displaying the sign-in page.
		function ShowSigninPage(json) 
		{
			var cookieName = GetHRDCookieName();
			var numIdentityProviderButtons = 0;
			var showEmailEntry = false;
			var showMoreOptionsLink = false;

			identityProvidersoriginal = json;
			var length = identityProvidersoriginal.length;
			for (var i = length - 1; i >= 0; i--) {
			    identityProviders.push(identityProvidersoriginal[i]);
			}
			if (identityProviders.length == 0) 
			{
				var mainDiv = document.getElementById("SignInContent");

				mainDiv.appendChild(document.createElement("br"));
				mainDiv.appendChild(document.createTextNode("Error: No identity providers are associated with this application."));
			}

			// Loop through the identity providers
			for (var i in identityProviders)
			{
				// Show all sign-in options if no cookie is set
				if (cookieName === null) 
				{
					if (identityProviders[i].EmailAddressSuffixes.length > 0) 
					{
						showEmailEntry = true;
					}

					else 
					{
						// Only show a button if there is no email address configured for this identity provider.
						CreateIdentityProviderButton(identityProviders[i]);

						numIdentityProviderButtons++;
					}
				}
				// Show only the last selected identity provider if a cookie is set
				else 
				{
					if (cookieName == identityProviders[i].Name) 
					{
						CreateIdentityProviderButton(identityProviders[i]);

						var nodes = document.getElementsByTagName(cookieName);

						for(var i = 0; i < nodes.length;i++)
						{
							if(nodes[i].type == "button")

								nodes[i].click();
						}

						numIdentityProviderButtons++;
					}
					else 
					{
						showMoreOptionsLink = true;
					}
				}
			}

			//If the user had a cookie but it didn't match any current identity providers, show all sign-in options

			//if (cookieName !== null && numIdentityProviderButtons === 0 && !showEmailEntry) {

			//	ShowDefaultSigninPage();

			//}

				//Othewise, render the sign-in page normally

			//else {

			//	ShowSigninControls(numIdentityProviderButtons, showEmailEntry, showMoreOptionsLink);

			//}

			ShowDefaultSigninPage();

			document.getElementById("Main").style.display = "";

		}



		// Resets the sign-in page to its original state before the user logged in and received a cookie.

		function ShowDefaultSigninPage()
		{

			var numIdentityProviderButtons = 0;

			var showEmailEntry = false;

			document.getElementById("IdentityProvidersList").innerHTML = "";
			for (var i in identityProviders )
			{

				if (identityProviders[i].EmailAddressSuffixes.length > 0) {

					showEmailEntry = true;

				}

				else {

					CreateIdentityProviderButton(identityProviders[i]);

					numIdentityProviderButtons++;

				}

			}

			ShowSigninControls(numIdentityProviderButtons, showEmailEntry, false);

		}



		//Reveals the sign-in controls on the sign-in page, and ensures they are sized correctly
		function ShowSigninControls(numIdentityProviderButtons, showEmailEntry, showMoreOptionsLink) 
		{

			//Display the identity provider links, and size the page accordingly

			if (numIdentityProviderButtons > 0) {

				document.getElementById("LeftArea").style.display = "";

				if (numIdentityProviderButtons > 4) {

					var height = 325 + ((numIdentityProviderButtons - 4) * 55);

					document.getElementById("SignInContent").style.height = height + "px";

				}

			}

			//Show an email entry form if email mappings are configured

			if (showEmailEntry) {

				document.getElementById("RightArea").style.display = "";

				if (numIdentityProviderButtons === 0) {

					document.getElementById("RightArea").style.left = "0px";

					document.getElementById("LeftArea").style.display = "none";

				}

			}

		}



		//Creates a stylized link to an identity provider's login page
		function CreateIdentityProviderButton(identityProvider) 
		{
			var idpList = document.getElementById("IdentityProvidersList");
			var button = document.createElement("button");

			button.setAttribute("name", identityProvider.Name);
			button.setAttribute("id", identityProvider.LoginUrl);
			button.className = "IdentityProvider";
			button.onclick = IdentityProviderButtonClicked;

			// Display an image if an image URL is present
			if (identityProvider.ImageUrl.length > 0) 
			{
				var img = document.createElement("img");

				img.className = "IdentityProviderImage";
				img.setAttribute("src", identityProvider.ImageUrl);
				img.setAttribute("alt", identityProvider.Name);
				img.setAttribute("border", "0");
				img.onLoad = ResizeImage(img);

				button.appendChild(img);
			}

				// Otherwise, display a text link if no image URL is present
			else if (identityProvider.ImageUrl.length === 0) 
			{
				button.appendChild(document.createTextNode(identityProvider.Name));
			}

			idpList.appendChild(button);
		}


		// Gets the name of the remembered identity provider in the cookie, or null if there isn't one.
		function GetHRDCookieName() 
		{
			var cookie = document.cookie;

			if (cookie.length > 0) 
			{
				var cookieStart = cookie.indexOf(cookieName + "=");

				if (cookieStart >= 0) 
				{
					cookieStart += cookieName.length + 1;

					var cookieEnd = cookie.indexOf(";", cookieStart);

					if (cookieEnd == -1) 
					{
						cookieEnd = cookie.length;
					}

					return unescape(cookie.substring(cookieStart, cookieEnd));
				}

			}

			if(GetQueryStringParameter('UserType') != '')
			{
				var provider = GetQueryStringParameter('UserType');

				//TODO: Need to get the internal names of all of the ACS identity providers once they're added so we can auto-forward the users
				switch(provider)
				{
					case "Beam Suntory Employee":
						SetCookie("bsib2edev");
						return "bsib2edev";
					case "External Partner":
						SetCookie("bsib2cdev");
						return "bsib2cdev";
				}

				//SetCookie();
			}

			return null;
		}


		// Sets a cookie with a given name
		function SetCookie(name) 
		{
			var expiration = new Date();

			expiration.setDate(expiration.getDate() + cookieExpiration);
			var secure = "";

			// If your application uses SSL, consider setting secure=";secure".

			document.cookie = cookieName + "=" + escape(name) + ";expires=" + expiration.toUTCString() + secure;
		}

		// Sets a cookie to remember the chosen identity provider and navigates to it.
		function IdentityProviderButtonClicked() 
		{			
			SetCookie(this.getAttribute("name"));
			window.location = this.getAttribute("id");	

			return false;
		}

		
		function SetEmailError(string) 
		{
			var EmailAddressError = document.getElementById("EmailAddressError");

			if (EmailAddressError.hasChildNodes()) 
			{
				EmailAddressError.replaceChild(document.createTextNode(string), EmailAddressError.firstChild);
			}
			else 
			{
				EmailAddressError.appendChild(document.createTextNode(string));
			}
		}



		function EmailAddressEntered() 
		{
			var enteredEmail = document.getElementById("EmailAddressTextBox").value;
			var identityProvider = null;

			if (enteredEmail.length === 0) 
			{
				SetEmailError("Please enter an e-mail address.");

				return;
			}

			if (enteredEmail.indexOf("@") <= 0) 
			{
				SetEmailError("Please enter a valid e-mail address.");

				return;
			}

			var enteredDomain = enteredEmail.split("@")[1].toLowerCase();

			for (var i in identityProviders) 
			{
				for (var j in identityProviders[i].EmailAddressSuffixes) 
				{

					if (enteredDomain == identityProviders[i].EmailAddressSuffixes[j].toLowerCase()) 
					{
						identityProvider = identityProviders[i];
					}
				}
			}

			if (identityProvider === null) 
			{
				SetEmailError("" + "'" + enteredDomain + "'" + " is not a recognized e-mail domain.");

				return;
			}

			// If we have gotten this far the e-mail address suffix was recognized. Write a cookie and redirect to the login URL.
			SetCookie(identityProvider.Name);
			window.location = identityProvider.LoginUrl;
		}



		// If the image is larger than the button, scale maintaining aspect ratio.
		function ResizeImage(img) 
		{
			if (img.height > maxImageHeight || img.width > maxImageWidth) 
			{
				var resizeRatio = 1;

				if (img.width / img.height > maxImageWidth / maxImageHeight) 
				{
					// Aspect ratio wider than the button
					resizeRatio = maxImageWidth / img.width;
				}
				else 
				{
					// Aspect ratio taller than or equal to the button
					resizeRatio = maxImageHeight / img.height;
				}

				img.setAttribute("height", img.height * resizeRatio);
				img.setAttribute("width", img.width * resizeRatio);
			}
		}					
	</script>	
	<script type="text/javascript">
		var scriptSource = "";
		var domain = document.location.hostname;
		var deepLinkUri = GetQueryStringParameter("Source");
		var deepLink = encodeURIComponent(deepLinkUri);	
		
		if(domain == "connect.beamsuntory.com")
		{
			scriptSource = "https://beamsuntoryacs.accesscontrol.windows.net:443/v2/metadata/IdentityProviders.js?protocol=wsfederation&realm=urn%3asharepoint%3aspvms&reply_to=&context=" + deepLink + "&request_id=&version=1.0&callback=ShowSigninPage";
		}
		else
		{
			scriptSource = "https://bsib2edev.accesscontrol.windows.net/v2/metadata/IdentityProviders.js?protocol=wsfederation&realm=urn%3asharepoint%3aspvms&reply_to=&context=" + deepLink + "&request_id=&version=1.0&callback=ShowSigninPage";			
		}
		
		var script = document.createElement('script');
			
		script.id = 'acsScript';
		script.type = 'text/javascript';
		script.src = scriptSource;
		
		document.body.appendChild(script);
	</script>	
</body>
</html>

